<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <record id="view_project_task_budget_form_inherit" model="ir.ui.view">
            <field name="name">view.project.task.budget.form.inherit</field>
            <field name="model">project.task</field>
            <field name="inherit_id" ref="project.view_task_form2"/>
            <field name="arch" type="xml">
                <xpath expr="//h1" position="before">
                    <span class="o_form_label">
                        <field name="sequence_code" readonly="1"/>
                    </span>
                </xpath>
                <xpath expr="//field[@name='tag_ids']" position="after">
                    <field name="is_used_rate_and_qty" invisible="1"/>
                    <field name="can_be_village" invisible="1"/>
                    <field name="can_be_person" invisible="1"/>

                    <field name="is_land_acquisition" invisible="1"/>
                    <field name="is_warehouse" />
                    <field name="warehouse_id" invisible="not is_warehouse" required="is_warehouse"/>

                    <field name="is_village" invisible="not can_be_village or is_person"/>
                    <field name="is_person" invisible="not is_village"/>
                    <field name="total_quantity" invisible="not is_village"/>
                    <field name="no" invisible="not is_village"/>
                    <field name="uid_no" invisible="not is_village"/>
                    <field name="land_holder_name" invisible="not is_village"/>
                    <field name="father_name" invisible="not is_village"/>
                    <field name="category" invisible="not is_village"/>
                    <field name="cast" invisible="not is_village"/>
                    <field name="gender" invisible="not is_village"/>
                    <field name="total_tree_symbol" invisible="not is_village"/>
                    <field name="reallocation_funds" invisible="not is_village"/>
                    <field name="compensation_payable" invisible="not is_village"/>
                    <field name="compensation_payment" invisible="not is_village"/>
                    <field name="due_date" invisible="not is_village"/>
                    <field name="status" invisible="not is_village"/>
                </xpath>
                <xpath expr="//group/group[2]" position="inside">
                    <field name="is_create_budget"/>
                    <field name="calculation_type" invisible="not is_create_budget"/>
                    <field name="unit_id" invisible="not is_used_rate_and_qty"/>
                    <field name="quantity" invisible="not is_used_rate_and_qty"/>
                    <field name="rate" invisible="not is_used_rate_and_qty"/>

                    <field name="percentage_value" invisible="calculation_type not in ['add_percentage']"/>
                    <field name="reference_task_id" invisible="calculation_type not in ['add_percentage']"
                           domain="[('project_id', '=', project_id), ('id', '!=', id)]"/>
                    <field name="reference_task_ids" widget="many2many_tags"
                           invisible="calculation_type not in ['sum_children']"
                           domain="[('project_id', '=', project_id), ('id', '!=', id)]"/>

                    <field name="budget_amount" required="is_create_budget != False"/>
                    <field name="spend_amount"/>
                    <field name="word_of_budget_amount"/>
                    <field name="remarks" invisible="not is_used_rate_and_qty"/>
                    <field name="budget_type" invisible="1"/>
                    <label for="date_from" string="Period" invisible="not is_create_budget"/>
                    <div class="o_row" invisible="not is_create_budget">
                        <field name="date_from" nolabel="1" class="oe_inline" required="is_create_budget != False"/>
                        <i class="fa fa-long-arrow-right mx-2" aria-label="to" title="to"/>
                        <field name="date_to" nolabel="1" class="oe_inline" required="is_create_budget != False"/>
                    </div>
                    <field name="analytic_account_id" options="{'no_create': True}" invisible="not is_create_budget"
                           readonly="1"/>
                    <field name="budget_analytic_id" context="{'trigger_onchange': 1}" options="{'no_create': True}"
                           invisible="not is_create_budget" readonly="1"/>
                </xpath>
                <xpath expr="//page[@name='sub_tasks_page']//field[@name='child_ids']//list" position="attributes">
                    <attribute name="decoration-bf">display_type == 'line_section'</attribute>
                </xpath>
                <xpath expr="//page[@name='sub_tasks_page']//field[@name='child_ids']//list/field[@name='sequence']"
                       position="after">
                    <field name="display_type" column_invisible="True"/>
                    <field name="calculation_type" column_invisible="True"/>
                    <field name="can_be_village" column_invisible="True"/>
                    <field name="can_be_person" column_invisible="True"/>
                    <field name="is_land_acquisition" column_invisible="True"/>
                    <field name="is_village" column_invisible="True"/>
                    <field name="is_person" column_invisible="True"/>

                </xpath>
                <xpath expr="//page[@name='sub_tasks_page']//field[@name='child_ids']//list" position="inside">
                    <control>
                        <create name="add_product_control" string="Add a line"/>
                        <create name="add_section_control" string="Add a section"
                                context="{'default_display_type': 'line_section'}"/>
                    </control>
                </xpath>
                <xpath expr="//page[@name='sub_tasks_page']//field[@name='child_ids']//list/field[@name='user_ids']"
                       position="attributes">
                    <attribute name="invisible">display_type == 'line_section'</attribute>
                </xpath>
                <xpath expr="//page[@name='sub_tasks_page']//field[@name='child_ids']//list/field[@name='date_deadline']"
                       position="attributes">
                    <attribute name="column_invisible">parent.display_type == 'line_section'</attribute>
                </xpath>
                <xpath expr="//page[@name='sub_tasks_page']//field[@name='child_ids']//list/field[@name='activity_ids']"
                       position="attributes">
                    <attribute name="column_invisible">parent.display_type == 'line_section'</attribute>
                </xpath>
                <xpath expr="//page[@name='sub_tasks_page']//field[@name='child_ids']//list/field[@name='my_activity_date_deadline']"
                       position="attributes">
                    <attribute name="column_invisible">parent.display_type == 'line_section'</attribute>
                </xpath>
                <xpath expr="//page[@name='sub_tasks_page']//field[@name='child_ids']//list/field[@name='tag_ids']"
                       position="attributes">
                    <attribute name="column_invisible">parent.display_type == 'line_section'</attribute>
                </xpath>
                <xpath expr="//page[@name='sub_tasks_page']//field[@name='child_ids']//list/field[@name='stage_id']"
                       position="attributes">
                    <attribute name="column_invisible">parent.display_type == 'line_section'</attribute>
                </xpath>
                <xpath expr="//page[@name='sub_tasks_page']//field[@name='name']" position="after">
                    <field name="unit_id" optional="show"
                           invisible="display_type in 'line_section' or not parent.is_used_rate_and_qty"/>
                    <field name="quantity" optional="show"
                           invisible="display_type in 'line_section' or not parent.is_used_rate_and_qty"/>
                    <field name="rate" optional="show"
                           invisible="display_type in 'line_section' or not parent.is_used_rate_and_qty"/>
                    <field name="budget_amount" sum="Total sum of budget Amount" optional="show"
                           invisible="display_type in 'line_section'"/>
                    <field name="section_subtotal" sum="Total sum of budget Amount" string="Subtotal"
                           invisible="display_type != 'line_section'"
                           optional="show"
                           readonly="1"/>
                    <field name="remarks" optional="show"
                           invisible="display_type in 'line_section' or not parent.is_used_rate_and_qty"/>
                    <field name="total_quantity" optional="hide" invisible="not is_village"/>
                    <field name="no" optional="hide" invisible="not is_village"/>
                    <field name="uid_no" optional="hide" invisible="not is_village"/>
                    <field name="land_holder_name" optional="hide" invisible="not is_village"/>
                    <field name="father_name" optional="hide" invisible="not is_village"/>
                    <field name="category" optional="hide" invisible="not is_village"/>
                    <field name="cast" optional="hide" invisible="not is_village"/>
                    <field name="gender" optional="hide" invisible="not is_village"/>
                    <field name="total_tree_symbol" optional="hide" invisible="not is_village"/>
                    <field name="reallocation_funds" optional="hide" invisible="not is_village"/>
                    <field name="compensation_payable" optional="hide" invisible="not is_village"/>
                    <field name="compensation_payment" optional="hide" invisible="not is_village"/>
                    <field name="due_date" optional="hide" invisible="not is_village"/>
                    <field name="status" optional="hide" invisible="not is_village"/>

                </xpath>
                <xpath expr="//page[@name='sub_tasks_page']//field[@name='name']" position="before">
                    <field name="task_no"/>
                </xpath>
            </field>
        </record>

        <record id="project.project_task_action_sub_task" model="ir.actions.act_window">
            <field name="domain">[('parent_id', '=', active_id)]</field>
        </record>

    </data>
</odoo>