<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Portal My Material Requests Template -->
    <template id="portal_my_material_requests" name="My Material Requests">
        <t t-call="portal.portal_layout">
            <t t-set="title">My Material Requests</t>
            <div class="container">
                <div class="row mt-4">
                    <div class="col-12">
                        <h3>My Material Requests</h3>
                        <a href="/my/material-requests/create" class="btn btn-primary btn-sm mb-3">
                            <i class="fa fa-plus"/> Create New Request
                        </a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Reference</th>
                                    <th>Date</th>
                                    <th>Total Amount</th>
                                    <th>State</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="requests" t-as="request">
                                    <tr>
                                        <td><t t-esc="request.name"/></td>
                                        <td><t t-esc="request.request_date"/></td>
                                        <td><t t-esc="request.total_amount"/></td>
                                        <td><t t-esc="request.state"/></td>
                                        <td>
                                            <a t-attf-href="/my/material-requests/{{request.id}}" class="btn btn-sm btn-info">
                                                <i class="fa fa-eye"/> View
                                            </a>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Portal Material Request Detail Template -->
    <template id="portal_my_material_request_detail" name="Material Request Detail">
        <t t-call="portal.portal_layout">
            <t t-set="title">Material Request Detail</t>
            <div class="container">
                <div class="row mt-4">
                    <div class="col-12">
                        <h3>Material Request: <t t-esc="request.name"/></h3>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">Request Information</h5>
                            </div>
                            <div class="card-body">
                                <p><strong>Date:</strong> <t t-esc="request.request_date"/></p>
                                <p><strong>State:</strong> <t t-esc="request.state"/></p>
                                <p><strong>Total Amount:</strong> <t t-esc="request.total_amount"/></p>
                                <p><strong>Notes:</strong> <t t-esc="request.notes"/></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <h5>Material Lines</h5>
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Quantity</th>
                                    <th>Unit Price</th>
                                    <th>Subtotal</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="request.line_ids" t-as="line">
                                    <tr>
                                        <td><t t-esc="line.product_id.name"/></td>
                                        <td><t t-esc="line.quantity"/></td>
                                        <td><t t-esc="line.unit_price"/></td>
                                        <td><t t-esc="line.subtotal"/></td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Portal Create Material Request Template -->
    <template id="portal_create_material_request" name="Create Material Request">
        <t t-call="portal.portal_layout">
            <t t-set="title">Create Material Request</t>
            <div class="container">
                <div class="row mt-4">
                    <div class="col-12">
                        <h3>Create New Material Request</h3>
                    </div>
                </div>
                <form action="/my/material-requests/create" method="POST">
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Notes</label>
                                <textarea name="notes" class="form-control" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12">
                            <h5>Materials</h5>
                            <table class="table table-hover" id="materials-table">
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th>Quantity</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <select name="product_id" class="form-control">
                                                <t t-foreach="products" t-as="product">
                                                    <option t-att-value="product.id"><t t-esc="product.name"/></option>
                                                </t>
                                            </select>
                                        </td>
                                        <td>
                                            <input type="number" name="quantity" class="form-control" min="1" value="1"/>
                                        </td>
                                        <td>
                                            <button type="button" class="btn btn-danger" onclick="removeRow(this)">
                                                <i class="fa fa-trash"/>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <button type="button" class="btn btn-secondary btn-sm" onclick="addRow()">
                                <i class="fa fa-plus"/> Add Material
                            </button>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12">
                            <button type="submit" class="btn btn-primary">
                                <i class="fa fa-save"/> Submit Request
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <script>
                function addRow() {
                    var table = document.getElementById('materials-table').getElementsByTagName('tbody')[0];
                    var row = table.insertRow(0);
                    row.innerHTML = '<td><select name="product_id" class="form-control"><t t-foreach="products" t-as="product"><option value="' + products[0].id + '">' + products[0].name + '</option></t></select></td><td><input type="number" name="quantity" class="form-control" min="1" value="1"/></td><td><button type="button" class="btn btn-danger" onclick="removeRow(this)"><i class="fa fa-trash"/></button></td>';
                }
                function removeRow(button) {
                    button.closest('tr').remove();
                }
            </script>
        </t>
    </template>
</odoo>


